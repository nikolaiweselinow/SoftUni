procedure TfMain.FillModiles;
var
  i, j : Byte;
  module: TCustomAppModule;
  ModuleItem : TwwInspectorItem;
  ModuleAcc: TModAccItem;
begin
  if diParameters.GetItemByTagString('#Modules').HaveVisibleItem then
    diParameters.GetItemByTagString('#Modules').Items.Clear;

  for i := 0 to TonApp.Modules.Modules.Count - 1 do begin
    module := TonApp.Modules.Modules[i];
    ModuleItem := diParameters.GetItemByTagString('#Modules').Items.Add;
    ModuleItem.TagString := IntToStr(module.Number);
    ModuleItem.OnItemChanged := ItemChanged;

    ModuleItem.PickList.DisplayAsCheckbox := True;
    ModuleItem.PickList.Items.Add('True');
    ModuleItem.PickList.Items.Add('False');

    ModuleAcc := TonApp.Parameters.Modules.ModuleByNumber(module.Number);
    if NewClient and (module.Number = 1) then
      // когато дефинираме нов клиент искаме автоматично модул Kernel да идва чекнат за купуване
      // защото той задължително се продава на клиента
      ModuleItem.Checked := true
    else
      if Assigned(ModuleAcc) then
        ModuleItem.Checked := ModuleAcc.Enabled
      else
        ModuleItem.Checked := false;

    ModuleItem.Caption := ModuleItem.TagString + '-' + module.DisplayName;
    ModuleItem.Tag := 1; //Indikator che shte se ocwetiqwa

    if ModuleItem.Checked then
      CheckOptionalPoints(module);
    if module.Points.Count > 0 then
      for j := 0 to module.Points.Count - 1 do
        GoThroughPoint(module.Points[j], module, ModuleItem);
  end;

  with diParameters.GetItemByTagString('#Modules') do
    Expanded := HaveVisibleItem;
end;